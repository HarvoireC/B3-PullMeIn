<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PullMeIn - Connexion</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="auth-page">
  <main class="container narrow">
    <div class="auth-card">
      <h1 class="logo">PullMeIn</h1>
      <p class="subtitle">Connectez-vous ou continuez en invité</p>

      <div id="alreadyLogged" class="info hidden"></div>

      <form id="loginForm" class="form" autocomplete="on">
        <div class="form-row">
          <label for="name">Nom d'utilisateur</label>
          <input id="name" name="name" type="text" placeholder="Votre nom" required />
        </div>
        <div class="form-row">
          <label for="email">Email (facultatif)</label>
          <input id="email" name="email" type="email" placeholder="vous@exemple.com" />
        </div>
        <button type="submit" class="btn primary">Se connecter</button>
      </form>

      <div class="separator">
        <span>ou</span>
      </div>

      <button id="guestBtn" class="btn secondary">Continuer en invité</button>
    </div>
  </main>

  <script src="scripts/app.js"></script>
  <script>
    (function () {
      const form = document.getElementById('loginForm');
      const guestBtn = document.getElementById('guestBtn');
      const already = document.getElementById('alreadyLogged');

      const existing = window.getCurrentUser && getCurrentUser();
      if (existing) {
        already.classList.remove('hidden');
        already.innerHTML = `Vous êtes déjà connecté en tant que <strong>${existing.name}</strong>. ` +
          `<a class="link" href="articles.html">Continuer vers les articles</a>`;
      }

      form.addEventListener('submit', function (e) {
        e.preventDefault();
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        if (!name) {
          alert('Veuillez saisir un nom.');
          return;
        }
        const user = { name, email: email || null, isGuest: false };
        setCurrentUser(user);
        window.location.href = 'articles.html';
      });

      guestBtn.addEventListener('click', function () {
        const user = { name: 'Invité', email: null, isGuest: true };
        setCurrentUser(user);
        window.location.href = 'articles.html';
      });
    })();
  </script>
</body>
</html>
